# Laravel Project Context
- Generated: 2025-10-10T13:27:22+09:00

## Basic













Laravel Framework 8.83.29

### Git
52843cb

## Tree (top 3 levels, ignored: vendor|node_modules|storage|bootstrap/cache|public/storage|.git)
.
├── .editorconfig
├── .gitattributes
├── .gitignore
├── .styleci.yml
├── README.md
├── app
│   ├── Actions
│   │   └── Fortify
│   ├── Console
│   │   └── Kernel.php
│   ├── Exceptions
│   │   └── Handler.php
│   ├── Http
│   │   ├── Controllers
│   │   ├── Kernel.php
│   │   ├── Middleware
│   │   └── Requests
│   ├── Models
│   │   ├── Order.php
│   │   ├── Product.php
│   │   └── User.php
│   └── Providers
│       ├── AppServiceProvider.php
│       ├── AuthServiceProvider.php
│       ├── BroadcastServiceProvider.php
│       ├── EventServiceProvider.php
│       ├── FortifyServiceProvider.php
│       └── RouteServiceProvider.php
├── artisan
├── bootstrap
│   ├── app.php
│   └── cache
│       ├── .gitignore
│       ├── packages.php
│       └── services.php
├── composer.json
├── composer.lock
├── config
│   ├── app.php
│   ├── auth.php
│   ├── broadcasting.php
│   ├── cache.php
│   ├── cors.php
│   ├── database.php
│   ├── filesystems.php
│   ├── fortify.php
│   ├── hashing.php
│   ├── logging.php
│   ├── mail.php
│   ├── queue.php
│   ├── sanctum.php
│   ├── services.php
│   ├── session.php
│   └── view.php
├── database
│   ├── .gitignore
│   ├── factories
│   │   ├── ProductFactory.php
│   │   └── UserFactory.php
│   ├── migrations
│   │   ├── 2014_10_12_000000_create_users_table.php
│   │   ├── 2014_10_12_100000_create_password_resets_table.php
│   │   ├── 2014_10_12_200000_add_two_factor_columns_to_users_table.php
│   │   ├── 2019_08_19_000000_create_failed_jobs_table.php
│   │   ├── 2019_12_14_000001_create_personal_access_tokens_table.php
│   │   ├── 2025_09_19_000223_add_profile_columns_to_users_table.php
│   │   ├── 2025_10_1_003853_create_orders_table.php
│   │   └── 2025_10_2_092236_create_products_table.php
│   └── seeders
│       ├── DatabaseSeeder.php
│       └── ProductSeeder.php
├── make_status_report.sh
├── package.json
├── phpunit.xml
├── public
│   ├── .htaccess
│   ├── css
│   │   ├── common.css
│   │   ├── index.css
│   │   ├── login.css
│   │   ├── mypage.css
│   │   ├── product-create.css
│   │   ├── purchase.css
│   │   ├── register.css
│   │   └── sanitize.css
│   ├── favicon.ico
│   ├── index.php
│   └── robots.txt
├── resources
│   ├── css
│   │   └── app.css
│   ├── js
│   │   ├── app.js
│   │   └── bootstrap.js
│   ├── lang
│   │   ├── en
│   │   └── ja
│   └── views
│       ├── auth
│       ├── layouts
│       ├── mypage
│       ├── products
│       └── purchase
├── routes
│   ├── api.php
│   ├── channels.php
│   ├── console.php
│   └── web.php
├── server.php
├── status_report_2025-10-10_1327.md
├── tests
│   ├── CreatesApplication.php
│   ├── Feature
│   │   └── ExampleTest.php
│   ├── TestCase.php
│   └── Unit
│       └── ExampleTest.php
└── webpack.mix.js

37 directories, 82 files

## composer.json (first 200 lines)
{
    "name": "laravel/laravel",
    "type": "project",
    "description": "The Laravel Framework.",
    "keywords": ["framework", "laravel"],
    "license": "MIT",
    "require": {
        "php": "^7.3|^8.0",
        "fruitcake/laravel-cors": "^2.0",
        "guzzlehttp/guzzle": "^7.0.1",
        "laravel/fortify": "^1.19",
        "laravel/framework": "^8.75",
        "laravel/sanctum": "^2.11",
        "laravel/tinker": "^2.5"
    },
    "require-dev": {
        "facade/ignition": "^2.5",
        "fakerphp/faker": "^1.9.1",
        "laravel-lang/lang": "~7.0",
        "laravel/sail": "^1.0.1",
        "mockery/mockery": "^1.4.4",
        "nunomaduro/collision": "^5.10",
        "phpunit/phpunit": "^9.5.10"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true
    },
    "minimum-stability": "dev",
    "prefer-stable": true
}

---

## routes/web.php
<?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ProfileController;
use App\Http\Controllers\ProductController;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use App\Http\Controllers\PurchaseController;

// （ログイン後のみ）
Route::middleware(['auth', 'verified'])->group(function () {
    // 商品一覧・詳細・出品
    Route::get('/products', [ProductController::class, 'index'])->name('products.index');
    Route::get('/products/create', [ProductController::class, 'create'])->name('products.create'); // ★追加
    Route::get('/products/{id}', [ProductController::class, 'entrance'])->name('products.entrance');

    Route::get('/purchase/checkout/{product}', [PurchaseController::class, 'checkout'])
        ->name('purchase.checkout');
    Route::post('/purchase/confirm',  [PurchaseController::class, 'confirm'])->name('purchase.confirm');
    Route::post('/purchase/complete', [PurchaseController::class, 'complete'])->name('purchase.complete');

    // マイページ
    Route::get('/mypage', [ProfileController::class, 'show'])->name('profile.show');
    Route::get('/mypage/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::post('/mypage/profile', [ProfileController::class, 'update'])->name('profile.update');
});

// トップ（認証状態で分岐）
Route::get('/', fn() => auth()->check()
    ? redirect()->route('products.index')
    : redirect()->route('login'));

// メール認証（Fortifyでも必要になりそう）
Route::get('/email/verify', function () {
    return view('auth.verify-email');
})->middleware('auth')->name('verification.notice');

Route::get('/email/verify/{id}/{hash}', function (EmailVerificationRequest $request) {
    $request->fulfill();
    return redirect('/products');
})->middleware(['auth', 'signed'])->name('verification.verify');

Route::post('/email/verification-notification', function (Request $request) {
    $request->user()->sendEmailVerificationNotification();
    return back()->with('status', 'verification-link-sent');
})->middleware(['auth', 'throttle:6,1'])->name('verification.send');

// ★近いうちに消す★（AIが足せというので一応）動作確認用プレーンビュー
Route::get('/test', fn() => view('index'));

// ★近いうちに消す★（未ログインでも閲覧できる）一覧・詳細（とりあえず表示させる用）
Route::get('/g/products', [ProductController::class, 'index'])->name('products.index.guest');
Route::get('/g/products/{id}', [ProductController::class, 'entrance'])->name('products.entrance.guest');

// 出品の保存
Route::post('/products', [ProductController::class, 'store'])->name('products.store');

---

## routes/api.php (if any)
<?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
|
| Here is where you can register API routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| is assigned the "api" middleware group. Enjoy building your API!
|
*/

Route::middleware('auth:sanctum')->get('/user', function (Request $request) {
    return $request->user();
});

---

## Route List













+----------+------------------------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------+
| Method   | URI                                      | Name                            | Action                                                                            | Middleware                                                |
+----------+------------------------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------+
| GET|HEAD | /                                        |                                 | Closure                                                                           | web                                                       |
| GET|HEAD | api/user                                 |                                 | Closure                                                                           | api                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:sanctum                  |
| POST     | email/verification-notification          | verification.send               | Closure                                                                           | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Routing\Middleware\ThrottleRequests:6,1        |
| GET|HEAD | email/verify                             | verification.notice             | Closure                                                                           | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
| GET|HEAD | email/verify/{id}/{hash}                 | verification.verify             | Closure                                                                           | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Routing\Middleware\ValidateSignature           |
| GET|HEAD | forgot-password                          | password.request                | Laravel\Fortify\Http\Controllers\PasswordResetLinkController@create               | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| POST     | forgot-password                          | password.email                  | Laravel\Fortify\Http\Controllers\PasswordResetLinkController@store                | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| GET|HEAD | g/products                               | products.index.guest            | App\Http\Controllers\ProductController@index                                      | web                                                       |
| GET|HEAD | g/products/{id}                          | products.entrance.guest         | App\Http\Controllers\ProductController@entrance                                   | web                                                       |
| GET|HEAD | login                                    | login                           | Laravel\Fortify\Http\Controllers\AuthenticatedSessionController@create            | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| POST     | login                                    |                                 | Laravel\Fortify\Http\Controllers\AuthenticatedSessionController@store             | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
|          |                                          |                                 |                                                                                   | Illuminate\Routing\Middleware\ThrottleRequests:login      |
| POST     | logout                                   | logout                          | Laravel\Fortify\Http\Controllers\AuthenticatedSessionController@destroy           | web                                                       |
| GET|HEAD | mypage                                   | profile.show                    | App\Http\Controllers\ProfileController@show                                       | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| GET|HEAD | mypage/profile                           | profile.edit                    | App\Http\Controllers\ProfileController@edit                                       | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| POST     | mypage/profile                           | profile.update                  | App\Http\Controllers\ProfileController@update                                     | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| GET|HEAD | products                                 | products.index                  | App\Http\Controllers\ProductController@index                                      | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| POST     | products                                 | products.store                  | App\Http\Controllers\ProductController@store                                      | web                                                       |
| GET|HEAD | products/create                          | products.create                 | App\Http\Controllers\ProductController@create                                     | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| GET|HEAD | products/{id}                            | products.entrance               | App\Http\Controllers\ProductController@entrance                                   | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| GET|HEAD | purchase/checkout/{product}              | purchase.checkout               | App\Http\Controllers\PurchaseController@checkout                                  | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| POST     | purchase/complete                        | purchase.complete               | App\Http\Controllers\PurchaseController@complete                                  | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| POST     | purchase/confirm                         | purchase.confirm                | App\Http\Controllers\PurchaseController@confirm                                   | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate                          |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\EnsureEmailIsVerified          |
| GET|HEAD | register                                 | register                        | Laravel\Fortify\Http\Controllers\RegisteredUserController@create                  | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| POST     | register                                 |                                 | Laravel\Fortify\Http\Controllers\RegisteredUserController@store                   | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| POST     | reset-password                           | password.update                 | Laravel\Fortify\Http\Controllers\NewPasswordController@store                      | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| GET|HEAD | reset-password/{token}                   | password.reset                  | Laravel\Fortify\Http\Controllers\NewPasswordController@create                     | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| GET|HEAD | sanctum/csrf-cookie                      |                                 | Laravel\Sanctum\Http\Controllers\CsrfCookieController@show                        | web                                                       |
| GET|HEAD | test                                     |                                 | Closure                                                                           | web                                                       |
| GET|HEAD | two-factor-challenge                     | two-factor.login                | Laravel\Fortify\Http\Controllers\TwoFactorAuthenticatedSessionController@create   | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
| POST     | two-factor-challenge                     |                                 | Laravel\Fortify\Http\Controllers\TwoFactorAuthenticatedSessionController@store    | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\RedirectIfAuthenticated:web           |
|          |                                          |                                 |                                                                                   | Illuminate\Routing\Middleware\ThrottleRequests:two-factor |
| GET|HEAD | user/confirm-password                    |                                 | Laravel\Fortify\Http\Controllers\ConfirmablePasswordController@show               | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
| POST     | user/confirm-password                    | password.confirm                | Laravel\Fortify\Http\Controllers\ConfirmablePasswordController@store              | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
| GET|HEAD | user/confirmed-password-status           | password.confirmation           | Laravel\Fortify\Http\Controllers\ConfirmedPasswordStatusController@show           | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
| POST     | user/confirmed-two-factor-authentication | two-factor.confirm              | Laravel\Fortify\Http\Controllers\ConfirmedTwoFactorAuthenticationController@store | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| PUT      | user/password                            | user-password.update            | Laravel\Fortify\Http\Controllers\PasswordController@update                        | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
| PUT      | user/profile-information                 | user-profile-information.update | Laravel\Fortify\Http\Controllers\ProfileInformationController@update              | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
| POST     | user/two-factor-authentication           | two-factor.enable               | Laravel\Fortify\Http\Controllers\TwoFactorAuthenticationController@store          | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| DELETE   | user/two-factor-authentication           | two-factor.disable              | Laravel\Fortify\Http\Controllers\TwoFactorAuthenticationController@destroy        | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| GET|HEAD | user/two-factor-qr-code                  | two-factor.qr-code              | Laravel\Fortify\Http\Controllers\TwoFactorQrCodeController@show                   | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| GET|HEAD | user/two-factor-recovery-codes           | two-factor.recovery-codes       | Laravel\Fortify\Http\Controllers\RecoveryCodeController@index                     | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| POST     | user/two-factor-recovery-codes           |                                 | Laravel\Fortify\Http\Controllers\RecoveryCodeController@store                     | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
| GET|HEAD | user/two-factor-secret-key               | two-factor.secret-key           | Laravel\Fortify\Http\Controllers\TwoFactorSecretKeyController@show                | web                                                       |
|          |                                          |                                 |                                                                                   | App\Http\Middleware\Authenticate:web                      |
|          |                                          |                                 |                                                                                   | Illuminate\Auth\Middleware\RequirePassword                |
+----------+------------------------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------+

---

## Migrations
- 2014_10_12_000000_create_users_table.php
- 2014_10_12_100000_create_password_resets_table.php
- 2014_10_12_200000_add_two_factor_columns_to_users_table.php
- 2019_08_19_000000_create_failed_jobs_table.php
- 2019_12_14_000001_create_personal_access_tokens_table.php
- 2025_09_19_000223_add_profile_columns_to_users_table.php
- 2025_10_1_003853_create_orders_table.php
- 2025_10_2_092236_create_products_table.php

---

## Seeders
- DatabaseSeeder.php
- ProductSeeder.php

---

## Controllers (file list)
- app/Http/Controllers/Controller.php
- app/Http/Controllers/ProductController.php
- app/Http/Controllers/ProfileController.php
- app/Http/Controllers/PurchaseController.php

### Controllers (first ~200 lines each)


**app/Http/Controllers/Controller.php**
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Bus\DispatchesJobs;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;

class Controller extends BaseController
{
    use AuthorizesRequests, DispatchesJobs, ValidatesRequests;
}

```


**app/Http/Controllers/ProductController.php**
```php
<?php

namespace App\Http\Controllers;

use App\Models\Product;
use Illuminate\Http\Request;
use App\Http\Requests\StoreProductRequest;
use Illuminate\Support\Facades\Storage;

class ProductController extends Controller
{
    public function index(Request $request)
    {
        $q = $request->get('q');

        $products = Product::query()
            ->when( $q, fn ($w) => $w
            ->where( fn($x) => $x
                   -> where('title', 'like', "%{$q}%")
                   -> orWhere('brand', 'like', "%{$q}%")
                   -> orWhere('category', 'like', "%{$q}%")
                   )
            )
            ->latest()
            ->paginate(12);

        return view('products.index', compact('products'));
    }

    public function entrance($id)
    {
        $product = Product::findOrFail($id);
        return view('products.entrance', compact('product'));
    }

    public function store(StoreProductRequest $request)
    {
        $data = $request->validated();

        // 画像アップロード（必要）
        if ($request->hasFile('image')) {
            $data['image_path'] = $request->file('image')->store('products', 'public');
        }

        $product = Product::create($data);

        return redirect()
            ->route('products.entrance', $product->id)
            ->with('status', '出品を登録しました');
    }
}
```


**app/Http/Controllers/ProfileController.php**
```php
<?php

namespace App\Http\Controllers;

use App\Http\Requests\ProfileRequest;

class ProfileController extends Controller
{
    public function show()
    {
        $user = auth()->user();
        return view('mypage.show', compact('user'));
    }

    public function edit()
    {
        $user = auth()->user();
        return view('mypage.edit', compact('user'));
    }

    public function update(ProfileRequest $request)
    {
        $user = auth()->user();

        if ($request->hasFile('avatar')) {
            $path = $request->file('avatar')->store('avatars', 'public');
            $user->avatar_path = $path;
        }

        $user->name     = $request->name;
        $user->zipcode  = $request->zipcode;
        $user->address  = $request->address;
        $user->building = $request->building;
        $user->save();

        return redirect()->route('profile.show')->with('status', 'プロフィールを更新しました');
    }
}

```


**app/Http/Controllers/PurchaseController.php**
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Models\Order;

class PurchaseController extends Controller
{
    public function checkout($productId)
    {
        // ★ダミー。後でDBに差し替える
        $product = [
            'id'    => (int) $productId,
            'title' => 'サンプル商品',
            'price' => 47000,
        ];
        $user = Auth::user();

        return view('purchase.checkout', compact('product', 'user'));
    }

    public function confirm(Request $request)
    {
        $validated = $request->validate([
            'product_id' => ['required', 'integer'],
            'payment'    => ['required', 'in:convenience,card'],
        ]);

        // ★ダミー。後でエロクアントに差し替える？
        $product = [
            'id'    => (int) $validated['product_id'],
            'title' => 'サンプル商品',
            'price' => 47000,
        ];

        $user = Auth::user();
        if (empty($user->zipcode) || empty($user->address)) {
            return redirect()->route('profile.edit')
                ->with('error', '配送先が未設定です。プロフィールから設定してください。');
        }

        $paymentLabel = $validated['payment'] === 'card' ? 'カード払い' : 'コンビニ払い';

        return view('purchase.confirm', [
            'product'      => $product,
            'user'         => $user,
            'payment'      => $validated['payment'],
            'paymentLabel' => $paymentLabel,
        ]);
    }

    public function complete(Request $request)
    {
        $validated = $request->validate([
            'product_id' => ['required', 'integer'],
            'payment'    => ['required', 'in:convenience,card'],
        ]);

        // ★とりあえずダミー
        $product = [
            'id'    => (int) $validated['product_id'],
            'title' => 'サンプル商品',
            'price' => 47000,
        ];

        $user = Auth::user();

        $order = Order::create([
            'user_id'          => $user->id,
            'product_id'       => $product['id'],
            'price'            => $product['price'],
            'payment_method'   => $validated['payment'],
            'status'           => 'completed',
            'shipping_zip'     => $user->zipcode ?? '',
            'shipping_address' => $user->address ?? '',
            'shipping_building' => $user->building ?? '',
        ]);

        $paymentLabel = $validated['payment'] === 'card' ? 'カード払い' : 'コンビニ払い';

        return view('purchase.complete', [
            'order'        => $order,
            'product'      => $product,
            'paymentLabel' => $paymentLabel,
        ]);
    }
}

```


---

## Form Requests (file list)
- app/Http/Requests/LoginRequest.php
- app/Http/Requests/ProfileRequest.php
- app/Http/Requests/RegisterRequest.php
- app/Http/Requests/StoreProductRequest.php

### Form Requests (first ~200 lines each)


**app/Http/Requests/LoginRequest.php**
```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class LoginRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'email'    => ['required', 'email'],
            'password' => ['required'],
        ];
    }

    public function messages(): array
    {
        return [
            'email.required' => 'メールアドレスを入力してください',
            'password.required' => 'パスワードを入力してください',
            // 認証失敗時の文言は後でコントローラ側で
            // 「ログイン情報が登録されていません」を返す実装にします
        ];
    }
}
```


**app/Http/Requests/ProfileRequest.php**
```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class ProfileRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'avatar'   => ['nullable', 'mimes:jpeg,png'],
            'name'     => ['required', 'string', 'max:20'],
            'zipcode'  => ['required', 'regex:/^\d{3}-\d{4}$/'],
            'address'  => ['required', 'string'],
            'building' => ['nullable', 'string'],
        ];
    }

    public function messages(): array
    {
        return [
            'name.required' => 'お名前を入力してください',
            'name.max' => '20文字以内で入力してください',
            'zipcode.required' => '郵便番号を入力してください',
            'zipcode.regex' => '郵便番号はハイフンありの8文字で入力してください',
            'address.required' => '住所を入力してください',
            'avatar.mimes' => 'プロフィール画像は.jpegもしくは.pngを指定してください',
        ];
    }
}
```


**app/Http/Requests/RegisterRequest.php**
```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class RegisterRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'name'                  => ['required', 'string', 'max:20'],
            'email'                 => ['required', 'email'],
            'password'              => ['required', 'string', 'min:8', 'confirmed'],
            'password_confirmation' => ['required', 'string', 'min:8'],
        ];
    }

    public function messages(): array
    {
        return [
            'name.required' => 'お名前を入力してください',
            'name.max' => '20文字以内で入力してください',
            'email.required' => 'メールアドレスを入力してください',
            'email.email' => 'メールアドレスはメール形式で入力してください',
            'password.required' => 'パスワードを入力してください',
            'password.min' => 'パスワードは8文字以上で入力してください',
            'password_confirmation.required' => 'パスワードを入力してください', // シートでは確認用も必須
            'password.confirmed' => 'パスワードと一致しません',
        ];
    }
}
```


**app/Http/Requests/StoreProductRequest.php**
```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreProductRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true; // 認証ミドルウェアで守られてる？？
    }

    public function rules(): array
    {
        return [
            'title'       => ['required', 'string', 'max:100'],
            'brand'       => ['nullable', 'string', 'max:50'],
            'description' => ['nullable', 'string', 'max:1000'],
            'price'       => ['required', 'integer', 'min:1', 'max:9999999'],
            'condition'   => ['required', 'integer', 'between:1,6'],
            'category'    => ['nullable', 'string', 'max:50'],
            'image'       => ['nullable', 'image', 'max:2048'], // 2MB
        ];
    }

    public function attributes(): array
    {
        return [
            'title' => '商品名',
            'price' => '販売価格',
            'condition' => '商品の状態',
            'image' => '商品画像',
        ];
    }
}

```


---

## Models (file list)
- app/Models/Order.php
- app/Models/Product.php
- app/Models/User.php

### Models (first ~200 lines each)


**app/Models/Order.php**
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class Order extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'product_id',
        'price',
        'payment_method',
        'status',
        'shipping_zip',
        'shipping_address',
        'shipping_building',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }
}
```


**app/Models/Product.php**
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    use HasFactory;

    protected $fillable = [
        'title',
        'brand',
        'description',
        'price',
        'condition',
        'category',
        'image_path',
    ];

    public function getConditionLabelAttribute(): string
    {
        $labels = [1 => '新品', 2 => '未使用に近い', 3 => '目立った傷や汚れなし', 4 => 'やや傷や汚れあり', 5 => '傷や汚れあり', 6 => '全体的に状態が悪い'];
        return $labels[$this->condition] ?? '不明';
    }
}

```


**app/Models/User.php**
```php
<?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable implements MustVerifyEmail
{
    use HasApiTokens, HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array<int, string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'email_verified_at' => 'datetime',
    ];
}

```


---

## Views (paths)
- resources/views/auth/verify-email.blade.php
- resources/views/auth/register.blade.php
- resources/views/auth/login.blade.php
- resources/views/purchase/checkout.blade.php
- resources/views/purchase/complete.blade.php
- resources/views/layouts/app.blade.php
- resources/views/products/create.blade.php
- resources/views/products/index.blade.php
- resources/views/products/entrance.blade.php
- resources/views/mypage/show.blade.php
- resources/views/mypage/edit.blade.php

---

## Git Status
## main
?? status_report_2025-10-10_1327.md

### Recent Commits
52843cb chore: initial push (products: index/detail/create/store, seeds, CSS)
